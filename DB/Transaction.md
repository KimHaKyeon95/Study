2022/01/25

Transaction에 대해서는 이미 SQL을 처음 배울 때 개념을 보고 넘어갔지만 JPA를 배우기 시작하면서 트랜잭션에 관한 얘기가 지속적으로 나와서 
다시 한번 개념을 잡고 넘어가기로 했다.  

## Transaction
Transaction이란 간단하게 말해서 데이터베이스의 상태를 변화시키는 작업의 단위를 의미한다. Query를 하나의 묶음으로 처리해서 중간에 
실행이 중단되면 Rollback을 수행하여 처음부터 다시 실행하고, 실행을 마치면 Commit을 한다. 커밋을 통해 작업이 마무리되었음을 
나타내게 된다.

사용하는 이유는 데이터의 부정합을 막기 위해서이다.
- 데이터의 부정합이란?
  - 데이터가 연결되어있는 메모리 상에서 변경이 되는 경우 데이터들의 값을 일괄적으로 일치화 시키는 과정에서 
     데이터의 값이 다른 경우  
     
 
한번에 하나의 프로세스를 처리할 때 부정합이 발생하는 것을 효과적으로 막을 수 있지만 병렬처리를 하지 않는다면 전체 프로세스의 
효율이 너무나 떨어지게 된다. 그렇기 때문에 병렬처리를 하면서 부정합을 막기 위해서 트랜잭션을 사용하는 것이다. 부정합이 생겼을 때 문제가 생기기 이전의 상태로 롤백할 수 있도록 한다. 트랜잭션의 마무리 작업은 2가지이다.  

트랜잭션에는 4가지의 특성이 있는데,
1. 원자성(Atomicity)  
트랜잭션의 작업이 부분적으로 실행되거나 중단되지 않는 것을 보장하는 것
2. 일관성(Consistency)  
트랜잭션이 성공하면 일관적인 DB상태를 유지하는 것
3. 격리성(Isolation)  
트랜잭션 수행시 다른 트랜잭션이 끼어들지 못함
4. 지속성(Durability)  
성공적으로 수행된 트랜잭션은 영원히 반영됨. commit을 통해 현재 상태를 반영함  

위와 같은 특징의 ACID라고 한다.

## Spring에서의 Transaction
Spring은 트랜잭션 추상화를 지원하고 있다. 트랜잭션 추상화는 트랜잭션의 공통점을 담은 기술이다. 이를 이용해 각 기술(JDBC, JPA, Hibernate)에 종속적인 코드를 작성하지 않아도 일관적으로 트랜잭션을 처리할 수 있다. JDBC와 JPA에서 로컬 트랜잭션(같은 리소스 내에서 일어나는 독립적인 일들을 묶은 것)을 이용하면 DataSourceTxManager인터페이스를 사용하고 Hibernate에서 로컬 트랜잭션을 사용하면 HibernateTxManager를 사용하면 된다. 만약 기술에 상관없이 트랜잭션을 구현하고 싶다면 PlatformTransactionManager를 사용하면 된다.  
  
하지만 코드를 작성해서 트랜잭션을 구현하게 되면 기존의 비즈니스 로직 코드와 얽히면서 코드가 복잡해질 수 있다. 이렇게 한 코드에 여러가지 로직에 관한 코드가 섞이면 책임이 많아 진다고 하는데 이는 그리 좋은 현상은 아니다. 비즈니스 로직 코드에서 트랜잭션 코드를 빼내기 위해 AOP를 고안하였고 이를 구현하기 위해 @Transactional이라는 어노테이션을 고안했다.

## Spring에서의 @Transactional
Spring에서는 Connection객체를 공유해 하나의 트랜잭션으로 모든 작업을 관리할 때 발생하는 불필요한 작업을 방지하기 위해 Transaction Synchronization(트랜잭션 동기화)를 제공한다. Connection객체를 저장소에 저장하고 필요할 때 꺼내서 쓸 수 있도록 한 것이다.
JPA에서는 쿼리를 작성하지 않고 여러가지 Transaction에 관한 처리가 가능하다. @Transactional을 이용하여 이를 가능케 한다. 
이렇게 어노테이션을 붙여 외부에서 트랜잭션의 기능을 부여하는 것을 선언적 트랜잭션이라고 한다. 어노테이션이 붙게 되면 해당 메서드는 트랜잭션의 관리 대상이 된다. @Transactional을 통해 포인트컷에 등록하고 트랜잭션 속성을 부여하는 것이다.

